<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kami Flex Tube</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #0f0f0f;
      color: #fff;
      font-family: 'Roboto', sans-serif;
    }
    .card {
      background-color: #181818;
      border-radius: 10px;
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: scale(1.02);
    }
  </style>
</head>
<body class="min-h-screen">

  <!-- Header -->
  <header class="flex items-center justify-between px-6 py-4 bg-[#202020] shadow-md sticky top-0 z-50">
    <div class="flex items-center gap-3">
      <div class="text-2xl font-extrabold text-red-500">Kami Flex</div>
      <span class="text-white text-xl font-semibold">Tube</span>
    </div>
    <div class="flex-1 mx-4">
      <input id="searchInput" type="search" placeholder="Search videos..." 
        class="w-full px-4 py-2 rounded-full bg-[#121212] text-white border border-gray-700 focus:border-red-500 outline-none" />
    </div>
    <button id="searchBtn" class="px-4 py-2 bg-red-600 rounded-full hover:bg-red-700">Search</button>
  </header>

  <!-- Results -->
  <main class="p-6">
    <div id="status" class="text-center text-gray-400 mt-4">Type something to search...</div>
    <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-6"></div>
  </main>

<script>
const API_BASE = location.origin + '/api/tube';

const searchBtn = document.getElementById('searchBtn');
const searchInput = document.getElementById('searchInput');
const grid = document.getElementById('grid');
const statusEl = document.getElementById('status');

searchBtn.addEventListener('click', search);
searchInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') search(); });

async function search(){
  const query = searchInput.value.trim();
  if(!query) return;
  statusEl.innerText = 'Searching...';
  grid.innerHTML = '';
  try {
    const res = await fetch(`${API_BASE}?mode=search&q=${encodeURIComponent(query)}`);
    const data = await res.json();
    let videos = data.data || data.results || data.items || [];
    if (!videos.length) { statusEl.innerText = 'No videos found.'; return; }

    statusEl.innerText = `Found ${videos.length} videos`;

    videos.forEach(v => {
      const videoUrl = v.url || `https://www.youtube.com/watch?v=${v.videoId}`;
      const thumb = v.thumbnail || v.thumb || '';
      const title = v.title || 'Untitled Video';
      const card = document.createElement('div');
      card.className = 'card p-2';
      card.innerHTML = `
        <img src="${thumb}" alt="${title}" class="w-full rounded-lg mb-2">
        <h3 class="font-semibold text-sm mb-1">${title}</h3>
        <button class="w-full bg-red-600 rounded-lg py-1 hover:bg-red-700" onclick="download('${videoUrl}')">â¬‡ Download</button>
      `;
      grid.appendChild(card);
    });
  } catch (e) {
    console.error(e);
    statusEl.innerText = 'Failed to load videos.';
  }
}

async function download(videoUrl){
  try {
    const res = await fetch(`${API_BASE}?mode=download&url=${encodeURIComponent(videoUrl)}`);
    const data = await res.json();
    const link = data.url || data.download || data.link || (data.data && data.data.url);
    if (link && link.startsWith('http')) {
      window.open(link, '_blank');
    } else {
      alert('No direct download link found.');
    }
  } catch (e) {
    console.error(e);
    window.open(`https://api.princetechn.com/api/download/ytdlv2?apikey=prince&url=${encodeURIComponent(videoUrl)}`);
  }
}
</script>

</body>
</html>
